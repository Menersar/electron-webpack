{"version":3,"names":["_chalk","data","_interopRequireDefault","require","path","_interopRequireWildcard","_main","_util","_ChildProcessManager","_devUtil","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","obj","__esModule","default","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","debug","runWds","projectDir","env","isWin","process","platform","webpackDevServerPath","resolve","join","ELECTRON_WEBPACK_WDS_PORT","run","__dirname","cwd","startRenderer","webpackConfigurator","createConfigurator","production","configuration","sourceDir","dirStat","statOrNull","isDirectory","logProcess","relative","chalk","blue","hasDependency","lineFilter","CompoundRendererLineFilter","OneTimeLineFilter","Promise","reject","devServerProcess","e","ChildProcessManager","PromiseNotifier","on","error","logError","stdout","r","includes","logProcessErrorOutput","constructor","prefix","filtered","filter","line","startsWith","filters","some","it"],"sources":["../../src/dev/WebpackDevServerManager.ts"],"sourcesContent":["import chalk from \"chalk\"\nimport { ChildProcess } from \"child_process\"\nimport * as path from \"path\"\nimport { createConfigurator } from \"../main\"\nimport { statOrNull } from \"../util\"\nimport { ChildProcessManager, PromiseNotifier, run } from \"./ChildProcessManager\"\nimport { LineFilter, logError, logProcess, logProcessErrorOutput } from \"./devUtil\"\n\nconst debug = require(\"debug\")(\"electron-webpack\")\n\nfunction runWds(projectDir: string, env: any) {\n  const isWin = process.platform === \"win32\"\n  const webpackDevServerPath = require.resolve(path.join(\".bin\", \"webpack-dev-server\" + (isWin ? \".cmd\" : \"\")))\n  debug(`Start renderer WDS ${webpackDevServerPath} on ${env.ELECTRON_WEBPACK_WDS_PORT} port`)\n  return run(webpackDevServerPath, [\"--color\", \"--env.autoClean=false\", \"--config\", path.join(__dirname, \"../../webpack.renderer.config.js\")], {\n    env,\n    cwd: projectDir,\n  })\n}\n\n// 1. in another process to speedup compilation\n// 2. some loaders detect webpack-dev-server hot mode only if run as CLI\nexport async function startRenderer(projectDir: string, env: any) {\n  const webpackConfigurator = await createConfigurator(\"renderer\", {production: false, configuration: {projectDir}})\n  const sourceDir = webpackConfigurator.sourceDir\n  // explicitly set to null - do not handle at all and do not show info message\n  if (sourceDir === null) {\n    return\n  }\n\n  const dirStat = await statOrNull(sourceDir)\n  if (dirStat == null || !dirStat.isDirectory()) {\n    logProcess(\"Renderer\", `No renderer source directory (${path.relative(projectDir, sourceDir)})`, chalk.blue)\n    return\n  }\n\n  if (webpackConfigurator.hasDependency(\"electron-next\")) {\n    debug(`Renderer WDS is not started - there is electron-next dependency`)\n    return\n  }\n\n  const lineFilter = new CompoundRendererLineFilter([\n    new OneTimeLineFilter(\"Project is running at \"),\n    new OneTimeLineFilter(\"webpack output is served from \"),\n  ])\n  return await new Promise((resolve: (() => void) | null, reject: ((error: Error) => void) | null) => {\n    let devServerProcess: ChildProcess | null\n    try {\n      devServerProcess = runWds(projectDir, env)\n    }\n    catch (e) {\n      reject!(e)\n      return\n    }\n\n    //tslint:disable-next-line:no-unused-expression\n    new ChildProcessManager(devServerProcess, \"Renderer WDS\", new PromiseNotifier(resolve, reject))\n    devServerProcess.on(\"error\", error => {\n      if (reject == null) {\n        logError(\"Renderer\", error)\n      }\n      else {\n        reject(error)\n        reject = null\n      }\n    })\n\n    devServerProcess.stdout!!.on(\"data\", (data: string) => {\n      logProcess(\"Renderer\", data, chalk.blue, lineFilter)\n\n      const r = resolve\n      // we must resolve only after compilation, otherwise devtools disconnected\n      if (r != null && (data.includes(\": Compiled successfully.\") || data.includes(\": Compiled with warnings.\"))) {\n        resolve = null\n        r()\n      }\n    })\n\n    logProcessErrorOutput(\"Renderer\", devServerProcess)\n  })\n}\n\nclass OneTimeLineFilter implements LineFilter {\n  private filtered = false\n\n  constructor(private readonly prefix: string) {\n  }\n\n  filter(line: string) {\n    if (!this.filtered && line.startsWith(this.prefix)) {\n      this.filtered = true\n      return false\n\n    }\n    return true\n  }\n}\n\nclass CompoundRendererLineFilter implements LineFilter {\n  constructor(private readonly filters: Array<LineFilter>) {\n  }\n\n  filter(line: string) {\n    return !this.filters.some(it => !it.filter(line))\n  }\n}\n"],"mappings":"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"}
