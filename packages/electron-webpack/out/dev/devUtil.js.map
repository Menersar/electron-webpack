{"version":3,"names":["_chalk","data","_interopRequireDefault","require","obj","__esModule","default","filterText","s","lineFilter","lines","trim","split","filter","it","includes","length","join","logProcessErrorOutput","label","childProcess","stderr","on","logProcess","toString","chalk","red","logError","error","stack","LABEL_LENGTH","labelColor","log","process","stdout","write","bold","repeat","DelayedFunction","constructor","executor","handle","schedule","cancel","setTimeout","clearTimeout","exports","getCommonEnv","Object","assign","env","NODE_ENV","DEBUG_COLORS","DEBUG_FD"],"sources":["../../src/dev/devUtil.ts"],"sourcesContent":["import chalk from \"chalk\"\nimport { ChildProcess } from \"child_process\"\n\nexport interface LineFilter {\n  filter(line: string): boolean\n}\n\nfunction filterText(s: string, lineFilter: LineFilter | null) {\n  const lines = s\n    .trim()\n    .split(/\\r?\\n/)\n    .filter(it => {\n      if (lineFilter != null && !lineFilter.filter(it)) {\n        return false\n      }\n\n      // https://github.com/electron/electron/issues/4420\n      // this warning can be safely ignored\n      if (it.includes(\"Couldn't set selectedTextBackgroundColor from default ()\")) {\n        return false\n      }\n      if (it.includes(\"Use NSWindow's -titlebarAppearsTransparent=YES instead.\")) {\n        return false\n      }\n      return !it.includes(\"Warning: This is an experimental feature and could change at any time.\")\n        && !it.includes(\"No type errors found\")\n        && !it.includes(\"webpack: Compiled successfully.\")\n    })\n\n  if (lines.length === 0) {\n    return null\n  }\n  return \"  \" + lines.join(`\\n  `) + \"\\n\"\n}\n\nexport function logProcessErrorOutput(label: \"Electron\" | \"Renderer\" | \"Main\", childProcess: ChildProcess) {\n  childProcess.stderr!!.on(\"data\", data => {\n    logProcess(label, data.toString(), chalk.red)\n  })\n}\n\nexport function logError(label: \"Electron\" | \"Renderer\" | \"Main\", error: Error) {\n  logProcess(label, error.stack || error.toString(), chalk.red)\n}\n\nconst LABEL_LENGTH = 28\n\nexport function logProcess(label: \"Electron\" | \"Renderer\" | \"Main\", data: string | Buffer, labelColor: any, lineFilter: LineFilter | null = null) {\n  const log = filterText(data.toString(), lineFilter)\n  if (log == null || log.length === 0) {\n    return\n  }\n\n  process.stdout.write(\n    labelColor.bold(`┏ ${label} ${\"-\".repeat(LABEL_LENGTH - label.length - 1)}`) +\n    \"\\n\\n\" + log + \"\\n\" +\n    labelColor.bold(`┗ ${\"-\".repeat(LABEL_LENGTH)}`) +\n    \"\\n\"\n  )\n}\n\nexport class DelayedFunction {\n  private readonly executor: () => void\n  private handle: NodeJS.Timer | null = null\n\n  constructor(executor: () => void) {\n    this.executor = () => {\n      this.handle = null\n      executor()\n    }\n  }\n\n  schedule() {\n    this.cancel()\n    this.handle = setTimeout(this.executor, 5000)\n  }\n\n  cancel() {\n    const handle = this.handle\n    if (handle != null) {\n      this.handle = null\n      clearTimeout(handle)\n    }\n  }\n}\n\nexport function getCommonEnv() {\n  return {\n    ...process.env,\n    NODE_ENV: \"development\",\n    // to force debug colors in the child process\n    DEBUG_COLORS: true,\n    DEBUG_FD: \"1\",\n  }\n}"],"mappings":"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"}
