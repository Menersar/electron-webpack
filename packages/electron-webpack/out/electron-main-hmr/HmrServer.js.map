{"version":3,"names":["_crocket","data","_interopRequireDefault","require","obj","__esModule","default","debug","HmrServer","constructor","state","ipc","Crocket","listen","Promise","resolve","reject","socketPath","process","pid","toString","path","error","enabled","beforeCompile","built","stats","setImmediate","hash","toJson","assets","chunks","children","modules","emit"],"sources":["../../src/electron-main-hmr/HmrServer.ts"],"sourcesContent":["import Crocket from \"crocket\"\nimport { Stats } from \"webpack\"\n\nconst debug = require(\"debug\")(\"electron-webpack:dev-runner\")\n\nexport class HmrServer {\n  private state = false\n  readonly ipc = new Crocket()\n\n  listen(): Promise<string> {\n    return new Promise((resolve, reject) => {\n      const socketPath = `/tmp/electron-main-ipc-${process.pid.toString(16)}.sock`\n      this.ipc.listen({path: socketPath}, error => {\n        if (error != null) {\n          reject(error)\n        }\n        if (debug.enabled) {\n          debug(`HMR Server listening on ${socketPath}`)\n        }\n        resolve(socketPath)\n      })\n    })\n  }\n\n  beforeCompile() {\n    this.state = false\n  }\n\n  built(stats: Stats): void {\n    this.state = true\n    setImmediate(() => {\n      if (!this.state) {\n        return\n      }\n\n      const hash = stats.toJson({assets: false, chunks: false, children: false, modules: false}).hash\n      if (debug.enabled) {\n        debug(`Send built: hash ${hash}`)\n      }\n      this.ipc.emit(\"/built\", {hash})\n    })\n  }\n}"],"mappings":";;;;;;AAAA,SAAAA,SAAA;EAAA,MAAAC,IAAA,GAAAC,sBAAA,CAAAC,OAAA;EAAAH,QAAA,YAAAA,CAAA;IAAA,OAAAC,IAAA;EAAA;EAAA,OAAAA,IAAA;AAAA;AAA6B,SAAAC,uBAAAE,GAAA,WAAAA,GAAA,IAAAA,GAAA,CAAAC,UAAA,GAAAD,GAAA,KAAAE,OAAA,EAAAF,GAAA;AAG7B,MAAMG,KAAK,GAAGJ,OAAO,CAAC,OAAO,CAAC,CAAC,6BAA6B,CAAC;AAEvD,MAAOK,SAAS;EAAtBC,YAAA;IACU,KAAAC,KAAK,GAAG,KAAK;IACZ,KAAAC,GAAG,GAAG,KAAIC,kBAAO,GAAE;EAmC9B;EAjCEC,MAAMA,CAAA;IACJ,OAAO,IAAIC,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAI;MACrC,MAAMC,UAAU,GAAG,0BAA0BC,OAAO,CAACC,GAAG,CAACC,QAAQ,CAAC,EAAE,CAAC,OAAO;MAC5E,IAAI,CAACT,GAAG,CAACE,MAAM,CAAC;QAACQ,IAAI,EAAEJ;MAAU,CAAC,EAAEK,KAAK,IAAG;QAC1C,IAAIA,KAAK,IAAI,IAAI,EAAE;UACjBN,MAAM,CAACM,KAAK,CAAC;;QAEf,IAAIf,KAAK,CAACgB,OAAO,EAAE;UACjBhB,KAAK,CAAC,2BAA2BU,UAAU,EAAE,CAAC;;QAEhDF,OAAO,CAACE,UAAU,CAAC;MACrB,CAAC,CAAC;IACJ,CAAC,CAAC;EACJ;EAEAO,aAAaA,CAAA;IACX,IAAI,CAACd,KAAK,GAAG,KAAK;EACpB;EAEAe,KAAKA,CAACC,KAAY;IAChB,IAAI,CAAChB,KAAK,GAAG,IAAI;IACjBiB,YAAY,CAAC,MAAK;MAChB,IAAI,CAAC,IAAI,CAACjB,KAAK,EAAE;QACf;;MAGF,MAAMkB,IAAI,GAAGF,KAAK,CAACG,MAAM,CAAC;QAACC,MAAM,EAAE,KAAK;QAAEC,MAAM,EAAE,KAAK;QAAEC,QAAQ,EAAE,KAAK;QAAEC,OAAO,EAAE;MAAK,CAAC,CAAC,CAACL,IAAI;MAC/F,IAAIrB,KAAK,CAACgB,OAAO,EAAE;QACjBhB,KAAK,CAAC,oBAAoBqB,IAAI,EAAE,CAAC;;MAEnC,IAAI,CAACjB,GAAG,CAACuB,IAAI,CAAC,QAAQ,EAAE;QAACN;MAAI,CAAC,CAAC;IACjC,CAAC,CAAC;EACJ"}
